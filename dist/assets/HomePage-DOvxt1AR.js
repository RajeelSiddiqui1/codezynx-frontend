import{R as p,r as o,u as K,a as U,j as t,g as Y,V as x,b as q,d as J}from"./index-BAzBCm5Y.js";var W={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},T=p.createContext&&p.createContext(W),Q=["attr","size","title"];function X(e,a){if(e==null)return{};var r=Z(e,a),n,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(l=0;l<d.length;l++)n=d[l],!(a.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Z(e,a){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(a.indexOf(n)>=0)continue;r[n]=e[n]}return r}function j(){return j=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},j.apply(this,arguments)}function V(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?V(Object(r),!0).forEach(function(n){ee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ee(e,a,r){return a=te(a),a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function te(e){var a=ae(e,"string");return typeof a=="symbol"?a:a+""}function ae(e,a){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,a);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(e)}function B(e){return e&&e.map((a,r)=>p.createElement(a.tag,v({key:r},a.attr),B(a.child)))}function O(e){return a=>p.createElement(re,j({attr:v({},e.attr)},a),B(e.child))}function re(e){var a=r=>{var{attr:n,size:l,title:d}=e,y=X(e,Q),f=l||r.size||"1em",u;return r.className&&(u=r.className),e.className&&(u=(u?u+" ":"")+e.className),p.createElement("svg",j({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,y,{className:u,style:v(v({color:e.color||r.color},r.style),e.style),height:f,width:f,xmlns:"http://www.w3.org/2000/svg"}),d&&p.createElement("title",null,d),e.children)};return T!==void 0?p.createElement(T.Consumer,null,r=>a(r)):a(W)}function ne(e){return O({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"},child:[]},{tag:"path",attr:{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"},child:[]}]})(e)}function se(e){return O({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"1"},child:[]},{tag:"circle",attr:{cx:"12",cy:"5",r:"1"},child:[]},{tag:"circle",attr:{cx:"12",cy:"19",r:"1"},child:[]}]})(e)}function ie(e){return O({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"},child:[]},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"},child:[]},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"},child:[]},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"},child:[]}]})(e)}const oe=()=>{const[e,a]=o.useState([]),[r,n]=o.useState(!0),[l,d]=o.useState(null),[y,f]=o.useState(!1),[u,w]=o.useState(!1),[C,k]=o.useState(""),[S,D]=o.useState(""),[E,L]=o.useState(null),[_,F]=o.useState(!1),[M,z]=o.useState(!1),H=K(),{authUser:N}=U(),A=async()=>{try{const s=await Y();a(s)}catch(s){console.error("Failed to fetch posts:",s),x.error("Failed to load posts")}finally{n(!1)}};o.useEffect(()=>{A()},[]);const R=s=>{d(s),k(s.title),D(s.description),L(null),f(!0)},$=async s=>{var c,g;s.preventDefault(),F(!0);const i=new FormData;i.append("title",C),i.append("description",S),E&&i.append("attachments",E);try{await q(l._id,i),x.success("Post updated!"),f(!1),A()}catch(m){const b=((g=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:g.error)||m.message||"Failed to update post";x.error(b)}finally{F(!1)}},G=async()=>{var s,i;z(!0);try{await J(l._id),x.success("Post deleted!"),a(e.filter(c=>c._id!==l._id))}catch(c){const g=(i=(s=c==null?void 0:c.response)==null?void 0:s.data)==null?void 0:i.error;x.error(g||"Delete failed")}finally{z(!1),w(!1)}};return r?t.jsx("div",{className:"text-center py-10",children:"Loading posts..."}):t.jsxs("div",{className:"min-h-screen",children:[t.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-10",children:[t.jsx("h2",{className:"text-3xl font-bold mb-6 text-center",children:"All Posts"}),t.jsx("div",{className:"grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:e.map(s=>{var m,P,b,I;const i=((m=s.attachments)==null?void 0:m.url)||"",c=i.match(/\.(mp4|webm|ogg)$/i),g=i.match(/\.(jpg|jpeg|png|gif|webp)$/i);return t.jsxs("div",{className:"group relative border rounded-xl p-4 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden bg-base-100 cursor-pointer",onClick:()=>H(`/posts/${s._id}`),children:[(N==null?void 0:N._id)===((P=s.author)==null?void 0:P._id)&&t.jsxs("div",{className:"absolute top-3 right-3 dropdown dropdown-end z-10",onClick:h=>h.stopPropagation(),children:[t.jsx("div",{tabIndex:0,role:"button",className:"btn btn-sm btn-ghost",children:t.jsx(se,{className:"text-lg"})}),t.jsxs("ul",{tabIndex:0,className:"dropdown-content z-[1] menu p-2 shadow bg-base-200 rounded-box w-36",children:[t.jsx("li",{onClick:h=>{h.preventDefault(),h.stopPropagation(),R(s)},children:t.jsxs("span",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx(ne,{})," Edit"]})}),t.jsx("li",{onClick:h=>{h.preventDefault(),h.stopPropagation(),d(s),w(!0)},children:t.jsxs("span",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx(ie,{})," Delete"]})})]})]}),i&&g&&t.jsx("img",{src:i,alt:"Attachment",className:"rounded-lg mb-3 w-full h-80 object-cover transition-transform duration-300 group-hover:scale-105"}),i&&c&&t.jsx("video",{controls:!0,className:"rounded-lg mb-3 w-full h-80 object-cover",children:t.jsx("source",{src:i,type:"video/mp4"})}),t.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.title}),t.jsx("p",{className:"text-sm mb-2 line-clamp-3",children:s.description}),t.jsx("p",{className:"text-sm mb-2 line-clamp-3",children:s.longDesc}),t.jsxs("button",{onClick:()=>toggleLike.mutate(),className:"mt-3 text-sm text-pink-400",children:["❤️ Like (",((b=s.likes)==null?void 0:b.length)||0,")"]}),t.jsxs("div",{className:"text-xs text-gray-500 flex justify-between items-center mt-3",children:[t.jsxs("span",{children:["Author: ",((I=s.author)==null?void 0:I.fullName)||"Unknown"]}),t.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]})]},s._id)})})]}),y&&t.jsx("dialog",{className:"modal modal-open",children:t.jsxs("div",{className:"modal-box bg-base-100",children:[t.jsx("h3",{className:"font-bold text-lg mb-4",children:"Edit Post"}),t.jsxs("form",{onSubmit:$,children:[t.jsx("input",{type:"text",placeholder:"Title",value:C,onChange:s=>k(s.target.value),className:"input input-bordered w-full mb-3"}),t.jsx("textarea",{placeholder:"Description",value:S,onChange:s=>D(s.target.value),className:"textarea textarea-bordered w-full mb-3"}),t.jsx("input",{type:"file",onChange:s=>L(s.target.files[0]),className:"file-input file-input-bordered w-full mb-4"}),t.jsxs("div",{className:"modal-action",children:[t.jsx("button",{type:"button",className:"btn",onClick:()=>f(!1),children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn btn-error",disabled:_,children:_?"Saving...":"Save Changes"})]})]})]})}),u&&t.jsx("dialog",{className:"modal modal-open",children:t.jsxs("div",{className:"modal-box bg-base-100",children:[t.jsx("h3",{className:"font-bold text-lg",children:"Are you sure you want to delete this post?"}),t.jsxs("div",{className:"modal-action",children:[t.jsx("button",{className:"btn",onClick:()=>w(!1),children:"Cancel"}),t.jsx("button",{className:"btn btn-error",onClick:G,disabled:M,children:M?"Deleting...":"Yes, Delete"})]})]})})]})};export{oe as default};
